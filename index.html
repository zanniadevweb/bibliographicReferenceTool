<!DOCTYPE HTML>
<html lang="en">
	<head>
		<!-- https://www.zotero.org/support/dev/web_api/v3/basics -->
		<title>Ausonius Bibliography Converter - Alexandre ZANNI</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
	</head>
	<style>
	body {
	  font-family: 'Google Sans', sans-serif;
	  margin: 40px
	}

	multi-input {
	  display: inline-block;
	  margin: 0 20px 20px 0;
	}

	button {
	  background-color: #eee;
	  border: 1px solid #ddd;
	  font-size: 16px;
	  height: 30px;
	  margin: 0 10px 20px 0;
	}

	body > div {
	  align-items: center;
	  display: flex;
	}

	label {
	  margin: 0 20px 20px 0;
	}

	p {
	  text-align: center;
	}

	</style>

		<h1>Générateur automatique de références selon la norme Ausonius Éditions (Work In Progress)</h1>
		<h3> Exemples de résultats :</h3>
		Feugère, M., I., Rodriguez, A. dir. (2008): <i>Plaidoyer pour la ‘petite épigraphie’ : l’exemple de la cité de Béziers</i>, <i>Gallia Suppl. 59</i>, 467-489, Paris.
		</br>
		Dupont, M., Dupont, C. coll. (2008): “Plaidoyer pour la ‘petite épigraphie’ : l’exemple de la cité de Béziers” <b>in:</b> Feugère, M., I., Rodriguez, A. dir. 2008, <i>Gallia Suppl. 59</i>, 467-489, Paris.
		<div id="resultSingle"></div>
		<div id="resultContainerWithInside"></div>
		</br></br>

		<b>L'ouvrage doit en citer un autre ? Cocher si oui : </b><input id="checkboxInsidePublication" type="checkbox" onchange="hideInsidePublicationInputs()">
		</br></br>
		<button onclick="buildReference()" id="buttonGenerateReference">GENERER RÉFERENCE</button>
		</br></br>
		<h2>Résultat :</h2> <span id="spanResult"><h3>...</h3></span>

		</br></br>
		<h2> Remplir les champs ci-dessous avant de cliquer sur "Générer Résultat" :</h2>
		<span id="spanSaisir"><h3>Référence principale :</h3></span>

				<div style="display: flex; align-items: center">
					<label>Auteurs :</label>
					<multi-input>
						<input id="inputAuthorsMain" list="speakers" placeholder="Dupont S." title="Type in a name">
						<datalist id="speakers">
							<!-- <option value="Banquo"></option>
							<option value="Bishop Stokesly of London"></option> -->
						</datalist>
					</multi-input>
					<button id="getMain">Ajouter +1</button>
				</div>

				</br>
				Éd. ou Dir. ou Coll. : 		<select id="inputEdOrDirOrCollMain">
																		<option value="0">éd.</option>
																		<option value="1">dir.</option>
																		<option value="2">coll.</option>
																	</select>
				</br>
				Date de publication : <input type="text" id="inputDateMain" placeholder="2003" size="100" title="Type in a name">
				</br>
				Date de première publication (Facultatif) : <input type="text" id="inputDateFirstMain" placeholder="2003" size="100" title="Type in a name">
				</br>
				Éditeur / Collection : <input type="text" id="inputEditorMain" placeholder="Gallia Suppl. 59" size="100" title="Type in a name">
				</br>
				Pages (Facultatif) : <input type="text" id="inputPagesMain" placeholder="467-489" size="100" title="Type in a name">
				</br>
				Titre d'ouvrage : <input type="text" id="inputTitleMain" placeholder="Plaidoyer pour la ‘petite épigraphie’ : l’exemple de la cité de Béziers" size="100" title="Type in a name">
				</br>
				Lieu de publication : <input type="text" id="inputLocationMain" placeholder="Paris" size="100" title="Type in a name">

		</br></br>

		<span id="spanWithInsidePublicationInputs" style="display: none;">
			<span id="spanSaisir" ><h3>Référence contenue dans la principale :</h3></span>

				<div style="display: flex; align-items: center">
					<label>Auteurs :</label>
					<multi-input>
						<input id="inputAuthorsInside" list="speakers" placeholder="Dupont S." title="Type in a name">
						<datalist id="speakers">
							<!-- <option value="Banquo"></option>
							<option value="Bishop Stokesly of London"></option> -->
						</datalist>
					</multi-input>
					<button id="getInside">Ajouter +1</button>
				</div>

					<p id="values"></p>
					</br>
					Éd. ou Dir. ou Coll. : 		<select id="inputEdOrDirOrCollInside">
																			<option value="0">éd.</option>
																			<option value="1">dir.</option>
																			<option value="2">coll.</option>
																		</select>
					</br>
					Date de publication : <input type="text" id="inputDateInside" placeholder="2003" size="100" title="Type in a name">
					</br>
					Date de première publication (Facultatif) : <input type="text" id="inputDateFirstInside" placeholder="2003" size="100" title="Type in a name">
					</br>
					Éditeur / Collection : <input type="text" id="inputEditorInside" placeholder="Gallia Suppl. 59" size="100" title="Type in a name">
					</br>
					<!-- Pages (Facultatif) : <input type="text" id="inputPagesInside" placeholder="467-489" size="100" title="Type in a name"> -->
					</br>
					Titre d'ouvrage : <input type="text" id="inputTitleInside" placeholder="Plaidoyer pour la ‘petite épigraphie’ : l’exemple de la cité de Béziers" size="100" title="Type in a name">
					</br>
					<!-- Lieu de publication : <input type="text" id="inputLocationInside" placeholder="Paris" size="100" title="Type in a name"> -->
			</span>

			<script>

			var authors = [];
			var mainPublication = [];
			var insidePublication = [];
			var facultativeDateOfFirstPublication = '';
			var facultativePages = '';

			function createSinglePublication(authors, dateOfPublication, dateOfFirstPublication, mainPublicationEditor, pagesFromMainPublication, editingPublicationLocation, titleOfWritingWork, editionOrDirectionOrCollection)
			{
				if (dateOfFirstPublication !== '') {
					facultativeDateOfFirstPublication = ' [' +  dateOfFirstPublication + '] ';
				} else {
					facultativeDateOfFirstPublication = '';
				}
				if (pagesFromMainPublication !== '') {
					facultativePages = ", " + pagesFromMainPublication;
				} else {
					facultativePages = '';
				}
				return spaceBetweenAuthors(authors) + " " +  editionOrDirectionOrCollection  + facultativeDateOfFirstPublication + " (" +  dateOfPublication + '): ' + titleOfWritingWork.italics() + ", " +   mainPublicationEditor.italics() + facultativePages +  ", " + editingPublicationLocation + '.';
			}

			function createContainerPublication(authors, dateOfPublication, dateOfFirstPublication, mainPublicationEditor, pagesFromMainPublication, editingPublicationLocation, titleOfWritingWork, editionOrDirectionOrCollection)
			{
				if (dateOfFirstPublication !== '') {
					facultativeDateOfFirstPublication = ' [' +  dateOfFirstPublication + '] ';
				} else {
					facultativeDateOfFirstPublication = '';
				}
				if (pagesFromMainPublication !== '') {
					facultativePages = ", " + pagesFromMainPublication;
				} else {
					facultativePages = '';
				}
				return spaceBetweenAuthors(authors) + " " + editionOrDirectionOrCollection + facultativeDateOfFirstPublication + " " + dateOfPublication + ", " + mainPublicationEditor.italics() + facultativePages +  ", " + editingPublicationLocation + '.';
			}

			function createInsidePublication(authors, dateOfPublication, dateOfFirstPublication, mainPublicationEditor, pagesFromMainPublication, editingPublicationLocation, titleOfWritingWork, editionOrDirectionOrCollection)
			{
				if (dateOfFirstPublication !== '') {
					facultativeDateOfFirstPublication = ' [' +  dateOfFirstPublication + '] ';
				} else {
					facultativeDateOfFirstPublication = '';
				}
					return spaceBetweenAuthors(authors) + " " +  editionOrDirectionOrCollection + facultativeDateOfFirstPublication + " (" + dateOfPublication + "): " + "“" + titleOfWritingWork + "”" + "<b>" + " in: " + "</b>";
			}

			function convertToAusoniusBibliographicNorms(mainPublication, insidePublication)
			{
				var bibliographicReferenceMainPublication = '';
				var bibliographicReferenceInsidePublication = '';
				var wholeBibliographicReference = '';

				var mainHasAuthors = false;
				var insideHasAuthors = false;

				if (mainPublication[0] !== '' && mainPublication[0] !== undefined) {
						mainHasAuthors = true;
				}
				if (insidePublication[0] !== '' && insidePublication[0] !== undefined) {
						insideHasAuthors = true;
				}

				if (insidePublication.length !== 0)
				{
					bibliographicReferenceMainPublication = createContainerPublication(mainHasAuthors ? addAuthors(mainPublication[0]) : '', mainPublication[1], mainPublication[2], mainPublication[3], mainPublication[4], mainPublication[5], mainPublication[6], mainPublication[7]);
					bibliographicReferenceInsidePublication = createInsidePublication(insideHasAuthors ? addAuthors(insidePublication[0]) : '', insidePublication[1], insidePublication[2], insidePublication[3], insidePublication[4], insidePublication[5], insidePublication[6], insidePublication[7]);
					document.getElementById('spanResult').innerHTML = bibliographicReferenceInsidePublication + bibliographicReferenceMainPublication;
				} else
				{
					bibliographicReferenceMainPublication = createSinglePublication(mainHasAuthors ? addAuthors(mainPublication[0]) : '', mainPublication[1], mainPublication[2], mainPublication[3], mainPublication[4], mainPublication[5], mainPublication[6], mainPublication[7]);
					document.getElementById('spanResult').innerHTML = bibliographicReferenceInsidePublication + bibliographicReferenceMainPublication;
				}

				wholeBibliographicReference = bibliographicReferenceInsidePublication + bibliographicReferenceMainPublication;
			}

			function addAuthors(arrayOfAuthors)
			{
				return arrayOfAuthors.join(', ');
			}

			// function convertAuthors(arrayOfAuthors)
			// {
			// 	// console.log('try convert');
			// 	arrayOfAuthors.forEach(function(authors){
			// 	//	console.log(authors.charAt(0).toUpperCase() + authors.toLowerCase().slice(1));
			// 		authors[0] = authors.charAt(0).toUpperCase() + authors.toLowerCase().slice(1); // familyname
			// 		authors[1] = authors.split(",").map(oneAuthor => oneAuthor.charAt(0).toUpperCase() + '.').toString(); // firstnameS
			// 	});
			//
			// 	var authors = '';
			// 	authors = arrayOfAuthors.toString();
			//
			// 	return authors;
			// }

			function spaceBetweenAuthors(string)
			{
				return string.toString().replaceAll(',', ', ');
			}

			function getValuesMultiInput(inputAuthorsNode)
			{
				  var that = inputAuthorsNode;
					const values = [];
					const items = that.querySelectorAll('.item');
					for (const item of items) {
						values.push(item.textContent);
					}
					return values;
			}

			function buildReference()
			{
					var checkboxInsidePublication = document.getElementById('checkboxInsidePublication');
					var isCheckedCheckboxInsidePublication = checkboxInsidePublication.checked;

					var inputAuthorsMainNode = document.getElementById('inputAuthorsMain').parentNode;
					var inputAuthorsMain = '';

					if (getValuesMultiInput(inputAuthorsMainNode).length > 0) {
					  inputAuthorsMain = getValuesMultiInput(inputAuthorsMainNode);
					}

					var inputDateMain = document.getElementById('inputDateMain').value;
					var inputDateFirstMain = document.getElementById('inputDateFirstMain').value;
					var inputEditorMain = document.getElementById('inputEditorMain').value;
					var inputPagesMain = document.getElementById('inputPagesMain').value;
					var inputLocationMain = document.getElementById('inputLocationMain').value;
					var inputTitleMain = document.getElementById('inputTitleMain').value;
					var inputEdOrDirOrCollMain = document.getElementById('inputEdOrDirOrCollMain').value;
					if (inputEdOrDirOrCollMain == 0)
					{
						inputEdOrDirOrCollMain = 'éd.';
					} else if (inputEdOrDirOrCollMain == 1)
					{
						inputEdOrDirOrCollMain = 'dir.';
					} else if (inputEdOrDirOrCollMain == 2)
					{
						inputEdOrDirOrCollMain = 'coll.';
					}

					var mainPublication = [];

					mainPublication.push(inputAuthorsMain, inputDateMain, inputDateFirstMain, inputEditorMain, inputPagesMain, inputLocationMain, inputTitleMain, inputEdOrDirOrCollMain);

					if (isCheckedCheckboxInsidePublication)
					{
						var inputAuthorsInsideNode = document.getElementById('inputAuthorsInside').parentNode;
						var inputAuthorsInside = '';
						if (getValuesMultiInput(inputAuthorsInsideNode).length > 0) {
							inputAuthorsInside = getValuesMultiInput(inputAuthorsInsideNode);
						}

						var inputDateInside = document.getElementById('inputDateInside').value;
						var inputDateFirstInside = document.getElementById('inputDateFirstInside').value;
						var inputEditorInside = document.getElementById('inputEditorInside').value;
						// var inputPagesInside = document.getElementById('inputPagesInside').value;
						var inputPagesInside = '';
						// var inputLocationInside = document.getElementById('inputLocationInside').value;
						var inputLocationInside = '';
						var inputTitleInside = document.getElementById('inputTitleInside').value;
						var inputEdOrDirOrCollInside = document.getElementById('inputEdOrDirOrCollInside').value;
						if (inputEdOrDirOrCollInside == 0)
						{
							inputEdOrDirOrCollInside = 'éd.';
						} else if (inputEdOrDirOrCollInside == 1)
						{
							inputEdOrDirOrCollInside = 'dir.';
						} else if (inputEdOrDirOrCollInside == 2)
						{
							inputEdOrDirOrCollInside = 'coll.';
						}

						var insidePublication = [];

					 insidePublication.push(inputAuthorsInside, inputDateInside, inputDateFirstInside, inputEditorInside, inputPagesInside, inputLocationInside, inputTitleInside, inputEdOrDirOrCollInside);
			 	}

				if (isCheckedCheckboxInsidePublication)
				{
					convertToAusoniusBibliographicNorms(mainPublication, insidePublication);
				}
				else
				{
					convertToAusoniusBibliographicNorms(mainPublication, []);
				}
			}

			function hideInsidePublicationInputs()
			{
				var checkboxInsidePublication = document.getElementById('checkboxInsidePublication');
				var isCheckedCheckboxInsidePublication = checkboxInsidePublication.checked;
				var spanWithInsidePublicationInputs = document.getElementById("spanWithInsidePublicationInputs");
				if (isCheckedCheckboxInsidePublication)
				{
					disableAndHideInputs(spanWithInsidePublicationInputs, false);
				} else
				{
					disableAndHideInputs(spanWithInsidePublicationInputs);
				}
			}

			function disableAndHideInputs(input, isToDisableAndHide = true) {
				if (isToDisableAndHide) {
					input.disabled = true;
					if (input.tagName.toLowerCase() === 'span') {
						input.style.display= 'none';
					}
				} else {
					if (input.tagName.toLowerCase() === 'span') {
						input.style.display= '';
					}
				}
			}

		</script>

  <script src="assets/js/multi-input.js"></script>

	</body>
</html>
